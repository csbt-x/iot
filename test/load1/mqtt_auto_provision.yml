settings:
  artifacts-dir: ./output/%Y-%m-%d_%H-%M-%S.%f

modules:
  jmeter:
    properties:
        logfile: ./output/jmeter.log

execution:
- concurrency: 1
  scenario: mqtt-client-auto-provision-sub
- concurrency: 1
  delay: 10s
  scenario: mqtt-client-auto-provision-pub

scenarios:

  mqtt-client-auto-provision-sub:
    protocol: mqtt
    requests:
    - cmd: connect
      addr: localhost
      clientId: ${id}
    - cmd: subscribe
      topic: provisioning/${id}/response
      time: 15s
      min-count: 1
    - cmd: disconnect

    data-sources:
    - path: ./tmp/devices.csv
      delimiter: ','
      quoted: false
      encoding: "utf-8"
      loop: false
      variable-names: id,cert
      random-order: false
      
  mqtt-client-auto-provision-pub:
    protocol: mqtt
    requests:
    - cmd: connect
      addr: localhost
      clientId: ${id}
    - cmd: publish
      topic: provisioning/${id}/request
      message: "{\"type\":\"x509\",\"cert\":\"${cert}\"}"
    - cmd: publish
      topic: provisioning/${id}/request
      message: "{\"type\":\"x509\",\"cert\":\"${cert}\"}"
    - cmd: disconnect

    data-sources:
    - path: ./tmp/devices.csv
      delimiter: ','
      quoted: false
      encoding: "utf-8"
      loop: false
      variable-names: id,cert
      random-order: false
